version: 1
backend:
    phases:
        preBuild:
            commands:
                - echo "*********** preBuild backend ***********"
                - corepack enable
                - nvm install 20.10
                - yarn
        build:
            commands:
                - echo "*********** build backend ***********"
#                - npx ampx pipeline-deploy --branch $AWS_BRANCH --app-id $AWS_APP_ID
                - amplifyPush --simple

frontend:
    phases:
        preBuild:
            commands:
                - echo "*********** preBuild frontend ***********"
                - echo "AWS_BRANCH_ID => $AWS_BRANCH"
                - echo "AWS_APP_ID => $AWS_APP_ID"
                - corepack enable
                - nvm install 20
                - npm install -g dotenv-cli
                - yarn
        build:
            commands:
                - echo "*********** build frontend ***********"
                - yarn build
    artifacts:
        baseDirectory: dist
        files:
            - '**/*'
    cache:
        paths:
            - .npm/**/*
            - node_modules/**/*
